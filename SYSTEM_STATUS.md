# ‚úÖ –°—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

**–î–∞—Ç–∞:** 10 –∂–æ–≤—Ç–Ω—è 2025, 13:28  
**–°—Ç–∞—Ç—É—Å:** üü¢ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î

---

## üìä –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω

### PM2 Process
```
‚úÖ ID: 0
‚úÖ Name: openai-proxy
‚úÖ Status: online
‚úÖ Restarts: 2
‚úÖ Memory: ~80MB
‚úÖ CPU: 0%
```

### Token Rotator
```json
{
  "current_token": "GITHUB_TOKEN",
  "total_tokens": 2,
  "tokens": [
    {
      "key": "GITHUB_TOKEN",
      "isCurrent": true,
      "blocked": false,
      "failures": 0
    },
    {
      "key": "GITHUB_TOKEN2",
      "isCurrent": false,
      "blocked": false,
      "failures": 0
    }
  ]
}
```

‚úÖ **–û–±–∏–¥–≤–∞ —Ç–æ–∫–µ–Ω–∏ –≥–æ—Ç–æ–≤—ñ –¥–æ —Ä–æ–±–æ—Ç–∏!**

---

## üîç –ü—Ä–æ –ª–æ–≥–∏ –∑ –ø–æ–º–∏–ª–∫–∞–º–∏ 429

### –©–æ –≤–∏ –±–∞—á–∏–ª–∏:
```
13:21:13 - [429-ERROR] Rate limit –¥–æ—Å—è–≥–Ω—É—Ç–æ
x-ratelimit-type: UserByModelByDay
retry-after: 23141s
```

### –ü–æ—è—Å–Ω–µ–Ω–Ω—è:
–¶–µ **—Å—Ç–∞—Ä—ñ –ø–æ–º–∏–ª–∫–∏** –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —Å–µ—Å—ñ–π (–¥–æ 13:28:28). PM2 –ø–æ–∫–∞–∑—É—î –æ—Å—Ç–∞–Ω–Ω—ñ —Ä—è–¥–∫–∏ –∑ `error.log`, —è–∫—ñ **–Ω–∞–∫–æ–ø–∏—á—É—é—Ç—å—Å—è** –º—ñ–∂ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏.

### –ß–æ–º—É –≤–æ–Ω–∏ —Ç–∞–º:
1. PM2 –ù–ï –æ—á–∏—â–∞—î –ª–æ–≥–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É
2. `--lines 20` –ø–æ–∫–∞–∑—É—î –æ—Å—Ç–∞–Ω–Ω—ñ 20 —Ä—è–¥–∫—ñ–≤ –∑ **–≤—Å—ñ—î—ó —ñ—Å—Ç–æ—Ä—ñ—ó**
3. –û—Å—Ç–∞–Ω–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –±—É–ª–∏ –æ 13:21:13
4. –û—Å—Ç–∞–Ω–Ω—ñ–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±—É–≤ –æ 13:28:28

**–í–∏—Å–Ω–æ–≤–æ–∫:** –¶–µ –ù–ï –ø–æ—Ç–æ—á–Ω—ñ –ø–æ–º–∏–ª–∫–∏, –∞ —ñ—Å—Ç–æ—Ä–∏—á–Ω—ñ –∑–∞–ø–∏—Å–∏.

---

## üéØ –ü–æ—Ç–æ—á–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### –¢–æ–∫–µ–Ω–∏ (—Ä—ñ–∑–Ω—ñ –∞–∫–∞—É–Ω—Ç–∏):
```env
GITHUB_TOKEN=gho_...Xq    # olegkizyma
GITHUB_TOKEN2=gho_...4d9U  # oleg121203
```

‚úÖ **–†—ñ–∑–Ω—ñ GitHub –∞–∫–∞—É–Ω—Ç–∏ = —Ä—ñ–∑–Ω—ñ –¥–µ–Ω–Ω—ñ –ª—ñ–º—ñ—Ç–∏!**

### Throttling:
```env
ENABLE_MODEL_THROTTLING=1
MODEL_MIN_INTERVAL_MS=2000  # 2 —Å–µ–∫—É–Ω–¥–∏ –º—ñ–∂ –∑–∞–ø–∏—Ç–∞–º–∏
```

### Rate Limiting:
```env
RATE_LIMIT_ENABLED=1
RATE_LIMIT_PER_MINUTE=30
```

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è
```bash
curl http://localhost:4000/health
# –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {"status":"ok"}
```

### 2. –¢–µ—Å—Ç throttling
```bash
# –î–≤–∞ —à–≤–∏–¥–∫–∏—Ö –∑–∞–ø–∏—Ç–∏
time bash -c '
  curl -s -X POST http://localhost:4000/v1/chat/completions \
    -H "Content-Type: application/json" \
    -d "{\"model\":\"gpt-4o-mini\",\"messages\":[{\"role\":\"user\",\"content\":\"Hi\"}],\"max_tokens\":5}" &
  curl -s -X POST http://localhost:4000/v1/chat/completions \
    -H "Content-Type: application/json" \
    -d "{\"model\":\"gpt-4o-mini\",\"messages\":[{\"role\":\"user\",\"content\":\"Hi\"}],\"max_tokens\":5}" &
  wait
'
# –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 
# - –ü–µ—Ä—à–∏–π –∑–∞–ø–∏—Ç: –º–∏—Ç—Ç—î–≤–æ
# - –î—Ä—É–≥–∏–π –∑–∞–ø–∏—Ç: –∑–∞—Ç—Ä–∏–º–∫–∞ ~2s
# - –í –ª–æ–≥–∞—Ö: [THROTTLE] –∑–∞—Ç—Ä–∏–º–∫–∞ 2000ms
```

### 3. –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–∫–µ–Ω—ñ–≤
```bash
watch -n 5 'curl -s http://localhost:4000/v1/tokens/stats | jq -r ".tokens[] | \"\(.key): blocked=\(.blocked), failures=\(.failures)\""'
```

---

## üìù –õ–æ–≥–∏ –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É (13:28:28)

```
13:28:28 - [STATIC-LIMITS] loaded 58 models          ‚úÖ
13:28:28 - OpenAI proxy listening on 4000            ‚úÖ
13:28:28 - [TOKEN-ROTATOR] –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ 2 —Ç–æ–∫–µ–Ω—ñ–≤ ‚úÖ
13:28:28 - [TOKEN-ROTATOR] –ü–æ—Ç–æ—á–Ω–∏–π —Ç–æ–∫–µ–Ω: GITHUB_TOKEN ‚úÖ
13:28:28 - [TOKEN-ROTATOR] –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Ç–∞ –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–±–æ—Ç–∏ ‚úÖ
```

**–ù–µ–º–∞—î –Ω–æ–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫!** –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ.

---

## üéØ –û—á—ñ–∫—É–≤–∞–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞

### –ü—Ä–∏ –Ω–æ—Ä–º–∞–ª—å–Ω—ñ–π —Ä–æ–±–æ—Ç—ñ:
```
[OPENAI-STD] Chat completions request for model: "gpt-4o-mini"
[THROTTLE] Model gpt-4o-mini: –∑–∞—Ç—Ä–∏–º–∫–∞ 2000ms
‚úÖ Response received
```

### –ü—Ä–∏ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—ñ –ª—ñ–º—ñ—Ç—É (—Ä—ñ–¥–∫–æ):
```
[OPENAI-STD] Chat completions request for model: "gpt-4o-mini"
[429-ERROR] Rate limit –¥–æ—Å—è–≥–Ω—É—Ç–æ –¥–ª—è –º–æ–¥–µ–ª—ñ gpt-4o-mini
[429-ERROR] –¢–∏–ø –ª—ñ–º—ñ—Ç—É: UserByModelByDay, retry-after: 82294s
[TOKEN-ROTATOR] –ü–æ–º–∏–ª–∫–∞ 429 –¥–ª—è —Ç–æ–∫–µ–Ω–∞ GITHUB_TOKEN, failures: 1
[TOKEN-ROTATOR] –ü–æ–º–∏–ª–∫–∞ 429 –¥–ª—è —Ç–æ–∫–µ–Ω–∞ GITHUB_TOKEN, failures: 2
[TOKEN-ROTATOR] –ü–æ–º–∏–ª–∫–∞ 429 –¥–ª—è —Ç–æ–∫–µ–Ω–∞ GITHUB_TOKEN, failures: 3
[TOKEN-ROTATOR] –ü–µ—Ä–µ–∫–ª—é—á–∞—î–º–æ—Å—å –∑ GITHUB_TOKEN –Ω–∞ GITHUB_TOKEN2
‚úÖ –¢–æ–∫–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ!
```

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

### 1. –û—á–∏—Å—Ç–∏—Ç–∏ —Å—Ç–∞—Ä—ñ –ª–æ–≥–∏ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
```bash
# –Ø–∫—â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –ø–æ–º–∏–ª–æ–∫
pm2 flush openai-proxy
```

### 2. –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
```bash
# –î–∏–≤–∏—Ç–∏—Å—å —Ç—ñ–ª—å–∫–∏ –Ω–æ–≤—ñ –∑–∞–ø–∏—Å–∏
pm2 logs openai-proxy

# –ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ emergency script
./token-emergency.sh watch
```

### 3. –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
```bash
# –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ç—É—Å
./token-status.sh

# –ü–æ–≤–Ω–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
./token-emergency.sh emergency
```

---

## ‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫

### –©–æ –±—É–ª–æ:
- ‚ùå –°—Ç–∞—Ä—ñ –ø–æ–º–∏–ª–∫–∏ 429 –≤ –ª–æ–≥–∞—Ö (–¥–æ 13:28:28)
- ‚ùå –®–≤–∏–¥–∫—ñ –∑–∞–ø–∏—Ç–∏ –±–µ–∑ throttling
- ‚ùå –û–¥–Ω–∞–∫–æ–≤—ñ —Ç–æ–∫–µ–Ω–∏ (–æ–¥–∏–Ω –∞–∫–∞—É–Ω—Ç)

### –©–æ —î –∑–∞—Ä–∞–∑:
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ (–∑ 13:28:28)
- ‚úÖ Throttling –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏–π (2s –º—ñ–∂ –∑–∞–ø–∏—Ç–∞–º–∏)
- ‚úÖ –†—ñ–∑–Ω—ñ —Ç–æ–∫–µ–Ω–∏ (2 —Ä—ñ–∑–Ω–∏—Ö –∞–∫–∞—É–Ω—Ç–∏)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Ä–æ—Ç–∞—Ü—ñ—è –ø—Ä–∏ 429
- ‚úÖ Circuit breaker –¥–ª—è –¥–µ–Ω–Ω–∏—Ö –ª—ñ–º—ñ—Ç—ñ–≤

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ —Ä–æ–±–æ—Ç–∏ –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º!** üéâ

---

## üìû –®–≤–∏–¥–∫—ñ –∫–æ–º–∞–Ω–¥–∏

```bash
# –°—Ç–∞—Ç—É—Å
./token-status.sh

# –õ–æ–≥–∏ (—Ç—ñ–ª—å–∫–∏ –Ω–æ–≤—ñ)
pm2 logs openai-proxy

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 restart openai-proxy

# –û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–≥–∏
pm2 flush openai-proxy

# –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
./token-emergency.sh watch
```
