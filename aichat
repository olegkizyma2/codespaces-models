#!/usr/bin/env bash
# AI Chat Global Command
# –ó–∞–ø—É—Å–∫–∞—î –ø—Ä–æ—Å—Ç–∏–π —á–∞—Ç –∑ 58 AI –º–æ–¥–µ–ª—è–º–∏ –∑ –±—É–¥—å-—è–∫–æ—ó –ø–∞–ø–∫–∏ –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ
# –ü—ñ–¥—Ç—Ä–∏–º—É—î TTS-–ø—Ä–æ–∫—Å–∏—Ä—É–≤–∞–Ω–Ω—è —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫ ngrok
#
# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è:
#   sudo cp aichat /usr/local/bin/aichat
#   sudo chmod +x /usr/local/bin/aichat
#
# –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:
#   aichat               # –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —á–∞—Ç –Ω–∞ –ø–æ—Ä—Ç—É 3010
#   aichat PORT=3011     # –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –Ω–∞ —ñ–Ω—à–æ–º—É –ø–æ—Ä—Ç—É
#   aichat stop          # –∑—É–ø–∏–Ω–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä
#   aichat restart       # –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∑ TTS —Ç–∞ ngrok —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ
#   aichat status        # –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
#   aichat logs          # –ø–æ–∫–∞–∑–∞—Ç–∏ –ª–æ–≥–∏
#   aichat test          # —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ API

# –®–ª—è—Ö –¥–æ –ø—Ä–æ–µ–∫—Ç—É —á–∞—Ç—É - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è
CHAT_PROJECT_DIR="/Users/dev/Documents/NIMDA/codespaces-models"

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É
if [ ! -d "$CHAT_PROJECT_DIR" ]; then
    echo "‚ùå –ü—Ä–æ–µ–∫—Ç —á–∞—Ç—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤: $CHAT_PROJECT_DIR"
    echo "üí° –û–Ω–æ–≤—ñ—Ç—å —à–ª—è—Ö –≤ —Ñ–∞–π–ª—ñ /usr/local/bin/aichat"
    exit 1
fi

if [ ! -f "$CHAT_PROJECT_DIR/Makefile" ]; then
    echo "‚ùå Makefile –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤: $CHAT_PROJECT_DIR"
    exit 1
fi

# –ö–æ–ª—å–æ—Ä–∏
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m'

# –ü–æ–∫–∞–∑–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∑–∞–ø—É—Å–∫
echo -e "${BLUE}ü§ñ AI Chat - –ó–∞–ø—É—Å–∫ –∑ $(pwd)${NC}"
echo -e "${BLUE}üìÅ –ü—Ä–æ–µ–∫—Ç: $CHAT_PROJECT_DIR${NC}"

# –ó–±–µ—Ä–µ–≥—Ç–∏ –ø–æ—Ç–æ—á–Ω—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é
ORIGINAL_DIR=$(pwd)

# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –ø—Ä–æ–µ–∫—Ç—É —Ç–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É
cd "$CHAT_PROJECT_DIR" || {
    echo "‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –ø–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –ø—Ä–æ–µ–∫—Ç—É"
    exit 1
}

# –ü–µ—Ä–µ–¥–∞—Ç–∏ –≤—Å—ñ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –¥–æ make
if [ $# -eq 0 ]; then
    # –ë–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ - –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —á–∞—Ç
    make chat
else
    # –†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥
    case "$1" in
        "restart")
            # –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞ restart - –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∑ TTS —Ç–∞ ngrok
            echo -e "${YELLOW}üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑ TTS –ø—Ä–æ–∫—Å–∏—Ä—É–≤–∞–Ω–Ω—è–º —Ç–∞ ngrok...${NC}"
            make restart-tts
            ;;
        "stop"|"status"|"logs"|"test"|"models"|"clean"|"help"|"ngrok"|"ngrok-stop")
            make "$@"
            ;;
        "PORT="*)
            # –ü–µ—Ä–µ–¥–∞—á–∞ –∑–º—ñ–Ω–Ω–∏—Ö –æ—Ç–æ—á–µ–Ω–Ω—è
            make chat "$@"
            ;;
        *)
            # –ü–µ—Ä–µ–¥–∞—á–∞ —è–∫ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è –∞–±–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
            make chat "$@"
            ;;
    esac
fi

# –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –≤ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é
cd "$ORIGINAL_DIR" || true

# –ü–æ–∫–∞–∑–∞—Ç–∏ —à–≤–∏–¥–∫—ñ –∫–æ–º–∞–Ω–¥–∏ –ø—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É
if [ $# -eq 0 ] || [ "$1" = "chat" ]; then
    echo ""
    echo -e "${YELLOW}üí° –®–≤–∏–¥–∫—ñ –∫–æ–º–∞–Ω–¥–∏ (–º–æ–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –∑ –±—É–¥—å-—è–∫–æ—ó –ø–∞–ø–∫–∏):${NC}"
    echo "  aichat stop      - –∑—É–ø–∏–Ω–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä"
    echo "  aichat restart   - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∑ TTS —Ç–∞ ngrok (—ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ)"
    echo "  aichat status    - –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å"
    echo "  aichat models    - –ø–æ–∫–∞–∑–∞—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ AI –º–æ–¥–µ–ª—ñ"
    echo "  aichat logs      - –ø–æ–∫–∞–∑–∞—Ç–∏ –ª–æ–≥–∏"
    echo "  aichat test      - —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ API"
    echo "  aichat ngrok     - –∑–∞–ø—É—Å—Ç–∏—Ç–∏ ngrok –æ–∫—Ä–µ–º–æ"
    echo "  aichat help      - –ø–æ–≤–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞"
elif [ "$1" = "restart" ]; then
    echo ""
    echo -e "${GREEN}üéâ Restart –∑–∞–≤–µ—Ä—à–µ–Ω–æ!${NC}"
    echo -e "${YELLOW}üí° TTS –¥–æ—Å—Ç—É–ø–Ω–∏–π —á–µ—Ä–µ–∑ ngrok URL + /tts${NC}"
    echo -e "${BLUE}–ü—Ä–∏–∫–ª–∞–¥: https://–≤–∞—à-ngrok-url.app/tts?text=–ø—Ä–∏–≤—ñ—Ç&voice=natalia${NC}"
fi
